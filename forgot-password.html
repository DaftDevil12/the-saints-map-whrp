<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>The Saints â€“ Password Reset Request</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    background: linear-gradient(to bottom right, #020617, #0f172a);
    color: #e5e7eb;
    font-family: 'Inter', sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .card {
    background: rgba(15,23,42,0.95);
    border-radius: 16px;
    border: 1px solid rgba(59,130,246,0.5);
    padding: 24px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    max-width: 420px;
    width: 100%;
  }
</style>
</head>
<body>
  <img id="top-watermark" src="watermark.png" style="position:fixed;top:20px;right:20px;width:120px;opacity:.6;pointer-events:none;" />

  <div class="card">
    <h1 class="text-xl font-bold text-blue-400 mb-2">Request Password Reset</h1>
    <p class="text-sm text-gray-300 mb-4">
      Enter your username and an admin will review your reset request.
    </p>

    <input id="username" class="w-full px-3 py-2 rounded-md bg-slate-900 border border-slate-700 text-sm mb-3" placeholder="Your username" />

    <button id="request-btn"
      class="w-full py-2 rounded-md bg-blue-600 hover:bg-blue-500 text-white font-semibold text-sm">
      Submit Request
    </button>

    <button onclick="window.location.href='login.html'"
      class="w-full mt-3 py-2 rounded-md bg-slate-700 hover:bg-slate-600 text-gray-100 text-sm">
      Back to Login
    </button>

    <p id="status" class="mt-4 text-xs text-gray-400"></p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getFirestore, doc, setDoc, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA2U-NjxMLD0uu3HLT79RQYx-t8L9hK40M",
      authDomain: "the-saints-2f622.firebaseapp.com",
      projectId: "the-saints-2f622",
      storageBucket: "the-saints-2f622.firebasestorage.app",
      messagingSenderId: "131705359242",
      appId: "1:131705359242:web:92fa93f8a10a8ae34a5673",
      measurementId: "G-36PY404Q8N"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById("request-btn").onclick = async () => {
      const username = document.getElementById("username").value.trim();
      const status = document.getElementById("status");

      if (!username) {
        alert("Enter your username.");
        return;
      }

      // Optional: check user exists
      const userRef = doc(db, "users", username);
      const userSnap = await getDoc(userRef);
      if (!userSnap.exists()) {
        status.textContent = "If this username exists, an admin will review it.";
        return;
      }

      const resetRef = doc(db, "passwordResets", username);

      await setDoc(resetRef, {
        username,
        requestedAt: serverTimestamp()
      });

      status.textContent = "Request submitted. An admin will set a one-time password for you.";
    };
  </script>
</body>
</html>
