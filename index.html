<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>The Saints - Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body {
    background: linear-gradient(to bottom right, #0f172a, #1e293b);
    color: #e2e8f0;
    font-family: 'Inter', sans-serif;
    height: 100vh;
    overflow: hidden;
  }

  .card {
    background: rgba(30, 41, 59, 0.85);
    border: 1px solid rgba(59, 130, 246, 0.4);
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    transition: 0.2s;
    backdrop-filter: blur(6px);
  }

  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.4);
  }

  #top-watermark {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 120px;
    opacity: 0.5;
    pointer-events: none;
  }

  #bottom-watermark {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0.6;
    font-size: 12px;
    color: #94a3b8;
  }
</style>
</head>

<body>

<!-- Top Image Watermark -->
<img id="top-watermark" src="watermark.png" alt="Saints Logo" />

<!-- Bottom Text Watermark -->
<div id="bottom-watermark">Made by Dante Alberts</div>

<!-- Main Layout -->
<div class="flex flex-col items-center justify-center h-full px-5">

  <!-- Welcome Box -->
  <h1 class="text-3xl font-bold text-blue-400 mb-2">Welcome <span id="username"></span></h1>
  <p class="text-gray-300 mb-10">Select a panel below to begin:</p>

  <!-- Responsive Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-3xl">

    <!-- Shared Map (trusted + admin only) -->
    <a id="btn-shared" href="sharedmap.html" class="card hidden">
      <h2 class="text-xl font-semibold mb-2 text-blue-300">üåç Shared Map</h2>
      <p class="text-gray-400 text-sm">Collaborative map for trusted members.</p>
    </a>

    <!-- Personal Map (everyone) -->
    <a id="btn-personal" href="personal-map.html" class="card">
      <h2 class="text-xl font-semibold mb-2 text-green-300">üó∫ Personal Map</h2>
      <p class="text-gray-400 text-sm">Your own private map.</p>
    </a>

    <!-- Admin Control Panel (admin only) -->
    <a id="btn-admin" href="admin.html" class="card hidden">
      <h2 class="text-xl font-semibold mb-2 text-red-300">üõ° Admin Panel</h2>
      <p class="text-gray-400 text-sm">Approve users & manage roles.</p>
    </a>

    <!-- Placeholder -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-2">üì¶ Placeholder</h2>
      <p class="text-gray-400 text-sm">Future Saints systems will go here.</p>
    </div>

  </div>

  <button id="logout-btn" class="mt-10 px-6 py-2 bg-red-600 hover:bg-red-500 rounded-md text-white">
    Logout
  </button>

</div>

<script type="module">
  import {
    initializeApp
  } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";

  import {
    getFirestore,
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA2U-NjxMLD0uu3HLT79RQYx-t8L9hK40M",
    authDomain: "the-saints-2f622.firebaseapp.com",
    projectId: "the-saints-2f622",
    storageBucket: "the-saints-2f622.firebasestorage.app",
    messagingSenderId: "131705359242",
    appId: "1:131705359242:web:92fa93f8a10a8ae34a5673",
    measurementId: "G-36PY404Q8N"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Session check
  const raw = localStorage.getItem("saintsUser");
  if (!raw) window.location.href = "login.html";

  let sessionUser;
  try {
    sessionUser = JSON.parse(raw);
  } catch {
    localStorage.removeItem("saintsUser");
    window.location.href = "login.html";
  }

  // Load user data from Firestore
  async function loadUser() {
    const ref = doc(db, "users", sessionUser.username);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
      localStorage.removeItem("saintsUser");
      window.location.href = "login.html";
      return;
    }

    const data = snap.data();

    if (!data.approved) {
      window.location.href = "awaiting-approval.html";
      return;
    }

    const role = data.role || "untrusted";
    document.getElementById("username").textContent = sessionUser.username;

    // Show Shared Map only if trusted or admin
    if (role === "trusted" || role === "admin") {
      document.getElementById("btn-shared").classList.remove("hidden");
    }

    // Show admin panel only if admin
    if (role === "admin") {
      document.getElementById("btn-admin").classList.remove("hidden");
    }
  }

  loadUser();

  // Logout button
  document.getElementById("logout-btn").onclick = () => {
    localStorage.removeItem("saintsUser");
    window.location.href = "login.html";
  };
</script>

</body>
</html>
